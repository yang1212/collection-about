## 前端工程化：体系设计与实践 | 周俊鹏

<img src="https://wfqqreader-1252317822.image.myqcloud.com/cover/574/23914574/t6_23914574.jpg" alt="书籍封面" class="wr_bookCover_img">

### 简介

前端工程化包含一系列规范和流程，其可提升前端工程师的工作效率，加快Web开发迭代速度，是现在前端开发领域中非常重要的一环。前端工程化：体系设计与实践》系统、全面地介绍了前端工程体系的各个环节，包括设计要点和实践经验。全书分为7章，分别是前端工程简史、脚手架、构建、本地开发服务器、部署、工作流、前端工程化的未来。

### 笔记

◆ 1.2 Node.js带给前端的改革

>> 。同构JavaScript的概念最早由Airbnb工程师Spike Brehm提出，简单讲就是令JavaScript编写的代码既可以在浏览器端工作，也可以在服务器端工作，如图1-3所示。这意味着服务器端和浏览器端都可以承载网页的渲染工作。

>> 服务器端渲染的网页更利于SEO（Search Engine Optimization，搜索引擎优化）。而其缺点是每访问一个页面都要发起请求，每个请求都需要服务器进行路由匹配、数据库查询、生成HTML文档后再发送响应给浏览器，这个过程会消耗服务器的大量计算资源

◆ 1.3 前后端分离

>> ·将JS、CSS、图片等静态资源部署到静态文件服务器。· HTML模板文件与中间层的Node.js代码一同部署到Web服务器。

◆ 1.5 工程化方案架构

>> 1．工作流管理工具，比如Grunt、Gulp。2．构建工具，比如webpack、rollup。3．整体解决方案，比如FIS、WeFlow。

>> rollup也是一款非常优秀的构建工具，但由于起步较晚，目前生态还不完整

>> 我们在设计工程化方案架构时，应当秉持“内核轻量、扩展丰富”的原则

◆ 2.2 脚手架在前端工程中的角色和特征

>> 这给脚手架工具带来了一个必须解决的问题：操作系统兼容性。

◆ 3.1 构建功能解决的问题

>> 目前我们所熟知的Grunt、Gulp、webpack等工具均是由Node.js为底层驱动平台的。

>> · 依赖打包——分析文件依赖关系，将同步依赖的文件打包在一起，减少HTTP请求数量。
· 资源嵌入——比如小于10KB的图片编译为base64格式嵌入文档，减少一次HTTP请求。
· 文件压缩——减小文件体积，缩短请求时间。
· hash指纹——通过给文件名加入hash指纹，以应对浏览器缓存策略。

◆ 3.3 ECMAScript与Babel

>> babel-preset-es2015插件是一个集合，包含了将ES6转化为ES5对应语法的所有插件

◆ 3.4 CSS预编译与PostCSS

>> CSS前期发展非常迅速，1994年哈肯·维姆·莱首次提出CSS,

>> PostCSS与Babel的不同之处在于，它所支持的所谓“未来CSS语法”并不是严格的CSS规范，其中大部分语法和特性目前只是CSS4的草案而已。很多人将PostCSS称为“CSS后编译器”，这个称谓可以在一定程度上说明目前业界对PostCSS的普遍使用方

◆ 3.5 模块化开发

>> 依赖管理是模块化规范的核心特性之一，

>> CommonJS是一种只适用于JavaScript的静态模块化规范，适合Node.js开发，但是并不适合浏览器环境

◆ 3.6 增量更新与缓存

>> 客户端的缓存可以分为以下两种。
1）利用本地存储，比如LocalStorage、SessionStorage等。
2）利用HTTP缓存策略，其中又分为强制缓存与协商缓存

>> Expires有一个致命的缺陷是：它所指定的时间点是以服务器为准的时间，但是客户端进行过期判断时是将本地的时间与此时间点对比。

>> max-age指定的是缓存的时间跨度，而非缓存失效的时间点，不会受到客户端与服务器时间误差的影响。所以，与Expires相比，max-age可以更精确地控制缓存，并且比Expires有更高的优先级。

>> 通过既定的数据摘要算法（目前使用较广泛的是md5）计算出文件的hash值

◆ 3.7 资源定位

>> 这种模式下的资源定位非常简单，由于静态资源与动态资源部署在同一路径，所以不论是开发还是生产环境，资源互相之间的引用使用相对路径即可

>> CDN（Content Delivery Network，内容分发网络）是一种部署策略，包括分布式存储、负载均衡、内容管理等模块。CDN的实现细节并不属于前端的范畴，但是如果Web站点使用了CDN部署策略，那么便会影响到资源定位的处理。

>> CDN的一个重要功能是将静态资源缓存到用户近距离的CDN节点上，不但能提高用户对静态资源的访问速度，还能节省服务器的带宽消耗、降低负载。

>> 这样做的主要目的是为了充分利用浏览器的并发请求能力，提高页面的加载速度。同时，独立域名的静态资源请求不会携带主页面的cookie等数据，这样进一步加快了网络访问。

>> ，因为静态资源是由服务器端开发人员负责部署到CDN服务器的，将资源固定放在某个路径，然后把解析函数或者工具的此信息设置为固定值就可以了。

>> 对于这种单入口的SPA项目，webpack的注入模式非常适用。因为只存在一个js文件和一个css文件，分别注入<body>和<head>底部即可，无须关注它们在HTML文档中的确切位置

>> webpack之所以成为目前最流行的构建工具之一，最关键的优势除体现在既有功能的强大以外，还体现在优秀的可扩展性。接下来，我们讲解如何使用webpack的扩展接口编写插件以满足上述需求。

◆ 3.8 总结

>> PostCSS是一种划时代的产品，理念类似于Babel，提倡开发者编写干净的源码，将琐碎且耗时的工作交给PostCSS。

◆ 4.1 本地开发服务器解决的问题

>> 动态构建和Mock服务是本地开发服务器的主要功能。

◆ 4.2 动态构建

>> webpack-dev-server是官方提供的用于搭建本地开发环境的一个微型Node.js服务框架，并且提供动态编译、HMR（热更新）等功能。

>> ，webpack同时提供了webpack-dev-middleware，它是Express框架的一个中间件，结合一些必要的功能模块可以实现动态编译以及热更新等功能。

>> 中间件是在输入到输出过程中对内容进行加工从而输出预想的数据

>> 只能借助于Express内置的static中间件将这些文件作为静态内容开放给HTTP服务，如下：

>> 上述代码的作用是将/libs路径的HTTP请求映射到本地项目中的/static目录。

>> 在webpack发布之前，业界大多数工具对此问题的解决方案是：在动态编译完成之后立即触发浏览器自动刷新，从而让浏览器及时获取重新编译之后的资源，这种方案被称为Livereload。

>> HMR以局部更新取代整体页面刷新，有效地弥补了Livereload无法保存页面状态的缺陷。
